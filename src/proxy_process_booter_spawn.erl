%% @copyright 2014 Takeru Ohta <phjgt308@gmail.com>
%%
%% @doc `erlang:spawn_opt/4'を使ってプロセスを生成するモジュール
-module(proxy_process_booter_spawn).

-behaviour(proxy_process_booter).

%%----------------------------------------------------------------------------------------------------------------------
%% Exported API
%%----------------------------------------------------------------------------------------------------------------------
-export([make/4]).

%%----------------------------------------------------------------------------------------------------------------------
%% Macros & Records
%%----------------------------------------------------------------------------------------------------------------------
-define(STATE, ?MODULE).

-record(?STATE,
        {
          spawn_options = [] :: [proxy:native_spawn_option()]
        }).

%%----------------------------------------------------------------------------------------------------------------------
%% 'proxy_process_booter' Callback API
%%----------------------------------------------------------------------------------------------------------------------
-export([start/2]).

%%----------------------------------------------------------------------------------------------------------------------
%% Exported Functions
%%----------------------------------------------------------------------------------------------------------------------
-spec make(module(), proxy:function_name(), [term()], [proxy:native_spawn_option()]) -> proxy_process_booter:booter().
make(Module, Function, Args, Options) ->
    %% TODO: validate Options
    proxy_process_booter:make(?MODULE, {Module, Function, Args}, #?STATE{spawn_options = Options}).

%%----------------------------------------------------------------------------------------------------------------------
%% 'proxy_process_booter' Callback Function
%%----------------------------------------------------------------------------------------------------------------------
%% @private
start({M, F, Args}, State) ->
    {ok, spawn_opt(M, F, Args, State#?STATE.spawn_options)}.

